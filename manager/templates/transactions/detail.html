{% extends 'master.html' %}

{% block content %}
<button onclick="history.back()" class="btn btn-secondary mb-3"><i class="bi bi-arrow-left"></i> Zurück</button><br>
    <div class="card mt-3"> 
        <div class="card-body shadow-sm"> 
            <h5 class="card-title"> 
                {{ transaction.sender }} 
                    <a href="{% url 'account_detail' transaction.sender.id %}"><i class="bi bi-box-arrow-up-right"></i></a>
                 &rarr; 
                 {{ transaction.receiver }} 
                    <a href="{% url 'account_detail' transaction.receiver.id %}"><i class="bi bi-box-arrow-up-right"></i></a>
            
            </h5>
            <p class="card-text"><i>Datum:</i> <strong>{{ transaction.timestamp|date:"d.m.Y H:i" }}</strong></p>
            <p class="card-text"><i>Betrag:</i> <strong>{{ transaction.amount }} €</strong></p>
            <div class="mb-3">
                <i>Kategorien:</i>
                <ul class="list-group-flush mt-1">
                    {% for split in transaction.splits.all %}
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-1 bg-transparent border-bottom-0">
                        <span>
                            <i class="{{ split.category.icon|default:'bi bi-tag' }} text-secondary me-1"></i>
                            {{ split.category.name }}
                        </span>
                        <span class="fw-bold text-secondary">{{ split.amount }} €</span>
                    </li>
                    {% empty %}
                    <li class="text-muted small">Keine Kategorie zugewiesen</li>
                    {% endfor %}
                </ul>
            </div>
            {% if transaction.description %}
                <p class="card-text"><i>Beschreibung:</i> <br> {{ transaction.description }}</p>
            {% endif %}
            {% if is_refund_of %}
                <p class="card-text text-warning">Diese Transaktion ist eine Rückerstattung von folgenden Transaktionen:</p>
                <ul>
                    {% for refund in is_refund_of %}
                    <li>
                        Transaktion ID {{ refund.original_transaction.id }}: {{ refund.original_transaction.amount }} € am {{ refund.original_transaction.timestamp|date:"d.m.Y H:i" }}
                        <a href="{% url 'transaction_detail' refund.original_transaction.id %}">
                            <i class="bi bi-box-arrow-up-right"></i>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if refunds %}
                <p class="card-text text-success">Diese Transaktion hat folgende Rückerstattungen:</p>
                <ul>
                    {% for refund in refunds %}
                    <li>
                        Rückerstattung ID {{ refund.refund_transaction.id }}: {{ refund.refund_transaction.amount }} € am {{ refund.refund_transaction.timestamp|date:"d.m.Y H:i" }}
                        <a href="{% url 'transaction_detail' refund.refund_transaction.id %}">
                            <i class="bi bi-box-arrow-up-right"></i>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
<div class="mt-4 border-top pt-3 d-flex justify-content-end">
    
    <a href="{% url 'transaction_edit' transaction.id %}" class="btn btn-outline-primary me-2">
        <i class="bi bi-pencil"></i> Bearbeiten
    </a>
    
    <a href="{% url 'transaction_delete' transaction.id %}" class="btn btn-outline-danger">
        <i class="bi bi-trash"></i> Löschen
    </a>

</div>
{% endblock %}